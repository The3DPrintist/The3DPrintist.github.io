<!DOCTYPE html>
<html>

<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link rel="stylesheet" href="../../style.css">
  <title>Send Stuff to my Printer</title>
  <meta name="referrer" content="no-referrer">
</head>

<body>
  
<div class="margin">
  <h1>Send Stuff to my Printer</h1>
</div>

<div class="section" style="text-align: left;">
    <p>
        I have a receipt printer by my computer, this website lets you send a short message to it!
        If you know me, feel free to ask for a photo.
        I promise this isn't compliment farming, I just think its funny.
    </p>
    <p>
        To send an image, send the URL! (must end in <code>.png</code>, <code>.jpg</code>, <code>.jpeg</code>, or <code>.webp</code>) (Imgur images don't work, sorry.)
    </p>
    <p>
        Spam is filtered automatically, only 1 message per minute.
    </p>

</div>

<div class="margincenter">

    <div class ="flexbox">

        <div class="flexsection" style="flex: 2; text-align: center;">
            <textarea class="textareapaper" id="message" name="message" onkeyup="updateCounter()" rows="16" cols="50" style="width: 100%; min-height: 100px;" maxlength="500" placeholder="Hello World!"></textarea>
        </div>
    
    </div>

    <div class ="flexbox">

        <div class="flexsection" style="flex: 2; text-align: center;">
            <p id="counter">0 / 500</p>
            <button class="btn btn-outline-light" onclick="sendClicked();" id="gen" style="width: 50%; height: 50%; ">Send</button>
        </div>

    </div>


    <div class ="flexbox">

        <div class="flexsection" style="flex: 2; text-align: center;">
            <p>Output</p>
            <textarea class="textareapaper" id="status" rows="100" style="width: 100%; min-height: 100px;" maxlength="500" placeholder="Send something!" disabled></textarea>
        </div>

    </div>
</div>

<!-- <div class="section" style="text-align: left;">
    <h2>How does it work?</h2>
</div> -->

<script>

    function sendData(data) {

        if(data.length > 500){
            return;
        }

        if(data.length < 1){
            return;
        }

        fetch('https://script.google.com/macros/s/AKfycbxUKESWQe1Ncq00v44lYotTq6x0e-PLdLkQgDnpRrroyvuKZdUj6DSqMMY_3FB8eM46/exec', {
            method: 'POST',
            mode: 'no-cors',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                'data': data
            })
        });

        console.log("data sent");
    }

    function sendClicked(){
        const texbox = document.getElementById("message");
        var msg = texbox.value.trim();

        if(msg.length > 0){
            sendData(msg)
            texbox.value = "";

            const statusbox = document.getElementById("status");
            if(statusbox.value == ""){
                statusbox.value = msg;
            }else{
                statusbox.value = statusbox.value + "\n\n" + msg;
            }


            updateCounter();
        }
    }

    function updateCounter(){
        const texbox = document.getElementById("message");
        const counter = document.getElementById("counter");
        var msg = texbox.value;
        counter.innerHTML = msg.length + " / 500" 

    }

</script>


</body>
</html>
